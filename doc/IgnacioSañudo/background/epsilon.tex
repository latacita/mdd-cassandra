%%==================================================================%%
%% Author : Sañudo Olmedo, Ignacio                                  %%
%%          Sánchez Barreiro, Pablo                                 %%
%% Version: 1.1, 18/06/2014                                         %%
%%                                                                  %%
%% Memoria del Proyecto Fin de Carrera                              %%
%% Background/Epsilon                                               %%
%===================================================================%%


Epsilon es una familia de lenguajes y herramientas para el desarrollo de software dirigido por modelos, entre estas herramientas podemos encontrar: herramientas de transformación de modelos, validación de modelos o generación de código entre otras funcionalidades. Epsilon es distribuido a través de la plataforma de modelado de lenguajes de Eclipse.
Epsilon proporciona multitud de lenguajes y herramientas para trabajar con modelos. Los lenguajes utilizados en este proyecto son EOL (Epsilon Object Language), ETL (Epsilon Transformation Language) y EGL (Epsilon Generation Language) también ha sido utilizado EUnit como herramienta para validar el código escrito por el generador de código Cassandra-CQL. Estos lenguajes y herramientas son descritos a continuación.

\subsection{Epsilon Object Language}
[2.1] Epsilon Object Language (EOL) es un lenguaje de programación imperativo utilizado para crear, consultar y modificar los modelos EMF. Según [2.1], EOL se puede considerar un lenguaje mezcla de Javascript y OCL, que combina lo mejor de ambos lenguajes. Como tal, proporciona todas las características habituales imperativas que se encuentran en Javascript (por ejemplo, la secuencia de la declaración, las variables, bucles for y while, etc) y todas las características interesantes de OCL como las operaciones sobre colecciones, por ejemplo Sequence\{1..5\}.select(x \textbar\ x \textgreater\ 3).


\begin{figure}[!tb]
  \centering
  \includegraphics[width=.8\linewidth]{background/images/ejCasa.eps} \\
  \caption{Ejemplo metamodelo casa}
  \label{back:fig:ejMetamodeloCasa}
\end{figure}


Para entender mejor el funcionamiento de EOL se expone el siguiente ejemplo. Se ha definido el meta-modelo mostrado en la figura~\ref{back:fig:ejMetamodeloCasa}, este meta-modelo consiste en la representación de una casa y las personas que viven en ella. Las personas tienen un nombre y un atributo booleano que representa si una persona está viva o no. Existe una relación de agregación para reflejar que la casa contiene personas.
Una vez creado el meta-modelo podemos crear un modelo como instancia de ese meta-modelo. Un ejemplo de cómo funciona EOL puede ser el siguiente: deseamos saber que personas habitan en la casa y están vivas. La sintaxis correspondiente sería la siguiente (figura~\ref{back:code:codigoEOL}).

\begin{figure}[!tb]
\begin{center}
\begin{footnotesize}
\begin{verbatim}
--------------------------------------------------------
for (person in Person.all){
  if (person.alive == true) {
    person.name.println();
  }
}

//Podemos realizar lo mismo de la siguiente manera:

Person.all.select(r|r.alive==true).name.println();

--------------------------------------------------------
\end{verbatim}
\end{footnotesize}
\end{center}
\caption{Ejemplo código EOL}
\label{back:code:codigoEOL}
\end{figure}


Como vemos la sintaxis es muy similar a cualquier lenguaje orientado a objetos, podemos manipular y consultar los objetos del modelo, sin embargo EOL no nos permite la definición de clases.


\subsection{Epsilon Transformation Language}
[2.1] Epsilon Transformation Language (ETL) es un lenguaje de transformación modelo a modelo basado en reglas (Model to Model-M2M). ETL proporciona las características estándar de un lenguaje de transformación, también nos permite manipular los modelos de entrada y salida así como su código fuente. ETL tiene su propia sintaxis sin embargo utiliza el lenguaje EOL como base.


Recordando el ejemplo de la Red de computadores y el Grafo detallado en el capitulo anterior (sección 1.2). Deseamos realizar la transformación de un modelo de tipo grafo a un modelo de tipo red para ello definiremos una serie de reglas de transformación utilizando para ello ETL. En primer lugar necesitamos definir el modelo del grafo para poder realizar la transformación a un modelo de tipo Red.
La figura~\ref{back:code:codigoETL} muestra el código que realiza el proceso de transformación de un Grafo a una Red.

\begin{figure}[!tb]
\begin{center}
\begin{footnotesize}
\begin{verbatim}

rule Arista2Cable
transform a : Grafo!Arista
to r : Red!Cable {	
    r.nameCable = a.nombreArista;
    if (a.parent.isDefined()) {
        r.parent=Red;
        for (nodoArista in a.children) {
            if(nodoArista.color=TColor#R){
                var PC : new Red!PC;
                PC.nameNodo="PC"+iPC;
                r.children.add(PC);
                iPC=iPC+1;	
            }
            else{
                var Router : new Red!Router;
                Router.nameNodo="Router"+iRouter;
                r.children.add(Router);
                iRouter=iRouter+1;
            }
        }
    }	
}

\end{verbatim}
\end{footnotesize}
\end{center}
\caption{Ejemplo código ETL}
\label{back:code:codigoETL}
\end{figure}

En este código encontramos solo una regla. Esta regla transforma aristas del grafo a cables de la red. La primera instrucción copia el nombre de la arista al cable. A continuación la primera condicional cuestiona si esa arista tiene un padre definido en caso afirmativo asigna el cable a la red. A continuación por cada nodo se crea o bien un PC o un router dependiendo del color del nodo que se esté analizando (rojo-PC, azul-Router). En siguiente lugar se asigna el nodo creado al cable correspondiente y finalmente se añade a la red. Este proceso se repite por cada arista del grafo. Una vez ejecutado este código dado un modelo de entrada de tipo Grafo obtenemos un modelo equivalente de tipo Red que cumple las reglas definidas en el meta-modelo.


\subsection{Epsilon Generation Language}

[2.1] [2.4] Epsilon Generation Language (EGL) es un lenguaje utilizado para la generación de código basado en la transformación de modelos (Model to Text-M2T).
EGL puede ser utilizado para transformar modelos en cualquier tipo de lenguaje, por ejemplo código ejecutable Java, código HTML o incluso aplicaciones completas que comprenden el código en varios lenguajes (por ejemplo, HTML, Javascript y CSS). En este proyecto se utilizara EGL para la generación de código Cassandra Query Language (CQL) a partir de modelos UML 2.0.

Cada plantilla de EGL contiene varias secciones. Cada sección puede ser estática o bien dinámica.
Una sección estática contiene texto que aparecerá en la salida generada por la plantilla. Una sección dinámica comienza con la secuencia '[\%' y termina con la secuencia '\%]'. La sección dinámica contiene lenguaje EOL.
La figura~\ref{back:code:codigoEGL} muestra como se realiza la generación de código HTML utilizando para ello el modelo generado de una red a partir de un grafo (ver sección anterior).

\begin{figure}[!tb]
\begin{center}
\begin{footnotesize}
\begin{verbatim}
--------------------------------------------------------
[%
    var red: Red := Red.allInstances().at(0);
%]

<html>
    <head>
        <title> Red </title>
    </head>
    <body>
        <h1>Conexiones</h1>				
        <table  border="1">
            <col style="width: 200px" />
            <col style="width: 100px" span="3" />
            [% for (conexiones in red.conexiones){%]
            <tr>
                <th scope="row">[%=conexiones.nameCable%]</th>
                [% for (nodos in conexiones.children){%]
                    <td>[%=nodos.nameNodo%]</td>
                [%	}%]
            </tr>
            [%	}%]
        </table>
    </body>
</html>
--------------------------------------------------------
\end{verbatim}
\end{footnotesize}
\end{center}
\caption{Ejemplo código EGL}
\label{back:code:codigoEGL}
\end{figure}

Como vemos en el código la integración del código EGL junto con HTML es total, en este sencillo código se genera una página HTML con una tabla que muestra varias filas, una fila por cada conexión entre dos componentes de la red. 